<!DOCTYPE html>
<html>
<head>
    <title>Polyberg</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0f172a; color: #f1f5f9; }
        .header { background: #1a2332; border-bottom: 1px solid #334; padding: 16px 24px; }
        .title { font-size: 24px; font-weight: 700; color: #06b6d4; }
        .container { display: grid; grid-template-columns: 280px 1fr 320px; gap: 20px; padding: 20px; }
        @media (max-width: 1200px) { .container { grid-template-columns: 1fr; } }
        .panel { background: rgba(30, 41, 59, 0.6); border: 1px solid #334; border-radius: 8px; padding: 16px; overflow-y: auto; }
        .markets-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; }
        .market { background: rgba(51, 65, 85, 0.3); border: 1px solid #334; border-radius: 6px; padding: 12px; cursor: pointer; }
        .market:hover { border-color: #06b6d4; }
        .market-title { font-size: 12px; font-weight: 600; margin-bottom: 8px; }
        .market-prices { display: flex; gap: 12px; margin-bottom: 8px; font-weight: 600; font-size: 12px; }
        .bid { color: #22c55e; }
        .ask { color: #ef4444; }
        .stats { font-size: 10px; color: #cbd5e1; padding-top: 8px; border-top: 1px solid #334; display: flex; justify-content: space-between; }
        .filter { padding: 8px 12px; margin-bottom: 6px; background: rgba(51, 65, 85, 0.2); border: 1px solid transparent; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .filter:hover { border-color: #06b6d4; }
        .filter.active { background: rgba(6, 182, 212, 0.2); border-color: #06b6d4; }
        .section { margin-bottom: 20px; }
        .section-title { font-size: 11px; font-weight: 700; text-transform: uppercase; color: #cbd5e1; margin-bottom: 10px; }
        .news-item { background: rgba(51, 65, 85, 0.2); border-left: 2px solid #06b6d4; padding: 8px; border-radius: 4px; font-size: 11px; margin-bottom: 8px; }
        .news-title { font-weight: 600; margin-bottom: 2px; }
        .news-source { color: #06b6d4; font-size: 10px; }
        #status { font-size: 12px; color: #cbd5e1; }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">âš¡ POLYBERG</div>
        <div id="status" style="margin-top: 8px;">Loading...</div>
    </div>

    <div class="container">
        <div class="panel">
            <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; color: #cbd5e1; margin-bottom: 12px;">Categories</div>
            <div id="categories"></div>
        </div>

        <div class="panel" style="overflow-y: auto;">
            <input type="text" id="search" placeholder="Search markets..." style="width: 100%; padding: 8px; background: rgba(51,65,85,0.3); border: 1px solid #334; color: #f1f5f9; border-radius: 4px; margin-bottom: 12px;" onkeyup="applyFilter()">
            <div class="markets-grid" id="markets"></div>
        </div>

        <div class="panel">
            <div class="section">
                <div class="section-title">News</div>
                <div id="news"></div>
            </div>
            <div class="section">
                <div class="section-title">Whales</div>
                <div id="whales"></div>
            </div>
        </div>
    </div>

    <script>
        let fullData = { markets: [], news: [], whales: [] };
        let filter = 'all';

        async function load() {
            try {
                const resp = await fetch('./data/live_data.json');
                const mktData = await resp.json();
                fullData.markets = mktData.markets || [];

                const newsResp = await fetch('./data/news.json');
                const newsData = await newsResp.json();
                fullData.news = newsData.articles || [];

                const whaleResp = await fetch('./data/whales.json');
                const whaleData = await whaleResp.json();
                fullData.whales = whaleData.top_whales || [];

                document.getElementById('status').textContent = `${fullData.markets.length} markets loaded`;
                render();
            } catch(e) {
                console.error(e);
                document.getElementById('status').textContent = 'Error: ' + e.message;
            }
        }

        function render() {
            renderCats();
            applyFilter();
            renderNews();
            renderWhales();
        }

        function renderCats() {
            const cats = {};
            fullData.markets.forEach(m => {
                const c = m.category || 'other';
                cats[c] = (cats[c] || 0) + 1;
            });

            let html = `<div class="filter ${filter==='all'?'active':''}" onclick="setFilter('all')">All (${fullData.markets.length})</div>`;
            for (const [c, n] of Object.entries(cats)) {
                html += `<div class="filter ${filter===c?'active':''}" onclick="setFilter('${c}')">${c} (${n})</div>`;
            }
            document.getElementById('categories').innerHTML = html;
        }

        function setFilter(cat) {
            filter = cat;
            renderCats();
            applyFilter();
        }

        function applyFilter() {
            const q = document.getElementById('search').value.toLowerCase();
            let mkts = fullData.markets.filter(m => {
                const catOk = filter === 'all' || (m.category || 'other') === filter;
                const qOk = !q || m.title.toLowerCase().includes(q);
                return catOk && qOk;
            }).sort((a,b) => b.liquidity - a.liquidity);

            let html = mkts.map(m => `
                <div class="market">
                    <div class="market-title">${m.title}</div>
                    <div class="market-prices">
                        <span class="bid">Bid $${m.bid.toFixed(3)}</span>
                        <span class="ask">Ask $${m.ask.toFixed(3)}</span>
                    </div>
                    <div class="stats">
                        <div>Liq: $${(m.liquidity/1e6).toFixed(1)}M</div>
                        <div>Vol: $${(m.volume_24h/1e3).toFixed(0)}K</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('markets').innerHTML = html || '<div style="color: #cbd5e1;">No markets found</div>';
        }

        function renderNews() {
            let html = fullData.news.slice(0, 5).map(n => `
                <a href="${n.url}" target="_blank" style="text-decoration:none; color:inherit;">
                    <div class="news-item">
                        <div class="news-title">${n.title}</div>
                        <div class="news-source">${n.source}</div>
                    </div>
                </a>
            `).join('');
            document.getElementById('news').innerHTML = html || '<div style="font-size: 11px; color: #cbd5e1;">No news</div>';
        }

        function renderWhales() {
            let html = fullData.whales.slice(0, 5).map(w => `
                <div style="background: rgba(51,65,85,0.2); border: 1px solid #334; border-radius: 4px; padding: 8px; margin-bottom: 8px; font-size: 10px;">
                    <div style="color: #06b6d4; font-family: monospace; word-break: break-all; margin-bottom: 4px;">${w.address}</div>
                    <div>Trades: ${w.trades_30d || 0}</div>
                    <div>Win: ${((w.win_rate || 0)*100).toFixed(0)}%</div>
                    <div>PnL: $${Math.abs(w.pnl_30d || 0).toLocaleString()}</div>
                </div>
            `).join('');
            document.getElementById('whales').innerHTML = html || '<div style="font-size: 11px; color: #cbd5e1;">No whales</div>';
        }

        window.addEventListener('load', load);
        setInterval(load, 60000);
    </script>
</body>
</html>
